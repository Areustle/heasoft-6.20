<!--=======================================-->
<!--  HEADAS HTML HELP FILE TEMPLATE, v1.1 -->
<!--=======================================-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html>
<head>
<style type="text/css">
  body { margin-left: 5%; margin-right: 5%; }
  h1,h2,h3,h4 { margin-left: -5%;}
</style>
<title>batbinevt HEADAS help file</title>
</head>
<body>

<h2>NAME</h2>

batbinevt - accumulate BAT event and DPH data into spectra, lightcurves or images

<h2>USAGE</h2>

<tt>batbinevt infile outfile outtype timedel timebinalg energybins</tt>

<h2>DESCRIPTION</h2>

<p>
batbinevt computes mask weighted light curves and spectra for BAT
event and detector plane histogram data (DPHs).  This tool can use the
weights generated by batmaskwtevt or batmaskwtimg to make binned
output light curves and spectra.  batbinevt can also be used to make
raw detector plane images and histograms, and to rebin raw detector
plane histograms in time or energy.
</p>

<p>
The input event file must normally have been processed first by
batmaskwtevt for a particular source position.  Thus, batbinevt will
only extract weighted products for one source at a time, although it
can compute many time or energy samples.
</p>

<h3>INPUT FILE TYPES</h3>

<p>
batbinevt operates on either event data or BAT DPH data.  Event data
must have the TIME and energy columns.  If weighting is applied, then
either the MASK_WEIGHT column must be present, or a separate mask
weight image file must be supplied.
</p>

<p>
batbinevt can also read detector plane histograms (DPHs). BAT DPHs
have two spatial dimensions and one energy dimension.  They are
produced by the BAT flight software, and also perhaps previous runs of
batbinevt.  They must contain an EBOUNDS extension which describes the
energy bin edges.
</p>


<h3>OUTPUT FILE TYPES</h3>

<p>
batbinevt can output several file types.  The most common will be
</p>

<dl>
<dt>LC
<dd>standard OGIP light curve (default: weighted=yes, outunits=RATE);

<dt>PHA
<dd>standard OGIP spectrum (type I or II; weighted=yes, outunits=RATE);<br>
Output format is determined automatically; if there is one output spectrum
then the output file is a type I spectrum; otherwise it is type II.

<dt>PHA1
<dd>standard OGIP spectrum (type I; default: weighted=yes, outunits=RATE);

<dt>PHA2
<dd>standard OGIP spectrum (type II; default: weighted=yes, outunits=RATE);
</dl>

<p>
batbinevt can also output histograms and images:
</p>

<dl>

<dt>DPH
<dd>detector plane histogram; for each temporal integration, a three
dimensional histogram of the number of counts is constructed with
two spatial dimensions (DETX and DETY) and one energy dimension.
batbinevt can rebin an existing DPH in time or energy, or generate a
new DPH from event data.  The EBOUNDS extension describes the energy
binning. (default: weighted=no, outunits=COUNTS);

<dt>DPI
<dd>detector plane image; a histogram of the number of counts in two
spatial dimensions (DETX and DETY).  Each FITS extension contains
only one DPI; multiple images are stored in concatenated FITS
extensions.  batbinevt can either "flatten" existing DPHs into DPIs,
or make new DPIs from event data. (default: weighted=no,
outunits=COUNTS);

<dt>DPITAB
<dd>detector plane image.  Images are stored in rows of a FITS
binary table (multiple images in one extension). (default:
weighted=no, outunits=COUNTS).
</dl>


<h3>WEIGHTED or UNWEIGHTED?</h3>

<p>
Applying mask weighting is equivalent to background subtraction.
Detectors which are fully shadowed are assigned a -1 weight, and fully
illuminated detectors a +1 weight, and partially illuminated detectors
are assigned an prorated value.  Thus, a weighted sum of the counts
will automatically subtract the background.
</p>

<p>
The default of the 'weighted' parameter depends on the output type.
</p>

<ul>
<li>light curves and spectra are <b>weighted</b> by default;</li>
<li>histograms and detector images are <b>not weighted</b> by default.</li>
</ul>

<p>
Users can choose to change the default by setting weighted to "yes" or
"no."
</p>

<p>
For event data, the default is to take the mask weighting values for
each event from the MASK_WEIGHT column.  This can be overridden by
using the maskwt parameter, which gives a mask weight map to be used
for all events.  [This parameter should not be used for event data
taken during slews.]  For DPHs, the mask weighting is also specified
using the maskwt parameter.
</p>


<h3>TIME BINNING</h3>

<p>
The user can choose how to bin the data in time.  For "uniform"
binning, a non-zero time bin size indicates that every time bin should
have the same size.  Beginning with the start of the first time
interval, time bins edges are placed at times according to the formula
<tt>T = N*TIMEDEL</tt>.  A value of timedel=0.0 indicates that all
input data should be summed into a single output time bin.
</p>

<p>
For "gti" binning, the user specifies the desired bins using the
gtifile parameter, which is in the standard GTI format.  Adjoining
good time intervals are not merged when using this method.  The
timedel bin size is ignored.  Note that the 'minfracexp' parameter is
always honored.  If it is important to preserve all requested bins,
even if they have zero exposure, then set minfracexp=0.
</p>

<p>
For "snr" and "highsnr" binning, the user specifies a signal-to-noise
ratio threshold with the snrthresh parameter.  While the events in a
time bin are being accumulated, and the total signal to noise ratio
reaches the threshold, a new time bin is started.  When timedel=0,
both the "snr" and "highsnr" binning methods behave the same way, but
they behave differently when timedel is non-zero, as explained below.
</p>

<p>
To specify a <i>maximum</i> signal to noise ratio then use "snr"
binning and set timedel to the maximum time bin size before a new bin
is started.  Resulting time bins will never be larger than timedel,
but may be smaller if the source is detected within a shorter time
interval.  When the source is detected, each bin will tend to have the
same significance (given by snrthresh); when the source is not
detected, each bin will tend to have the same time bin size (given by
timedel).
</p>

<p>
To specify a <i>minimum</i> signal to noise ratio then use "highsnr"
binning and set timedel to the minimum time bin size.  Resulting time
bins will have a duration of at least timedel, but may be larger if
the source is fainter and it takes a longer period of time to detect
it.  When the source is detected above snrthresh, each bin will tend
to have the same bin size (given by timedel); when the source is not
detected, the time bins will be larger.

<p>
The "infile" binning method only applies when the input is a DPH.
When the binning algorithm is set to "infile," then the time binning
of the input file is preserved in the output file.  This may be
useful, for example, if each DPH row is to be flattened into a
detector image, while otherwise preserving the individual exposures.
</p>

<p>
The "matchlc" binning method will bin the input data to match an
existing light curve.  The light curve, which is passed in the
'gtifile' parameter, must be a standard OGIP light curve file with
enough information to determine the time binning.  If the light curve
file has a GTI extension, it is ignored.  Note that the 'minfracexp'
parameter is always honored.  If it is important to exactly match the
template light curve time bins, even if they have zero exposure, then
set minfracexp=0.

<p>
For output light curves, the TIME column may refer to the start or the
center of the bin, depending on the setting of the 'timepixr'
parameter.  Output lightcurves also contain the keyword TIMEPIXR which
indicates the reference point for light curve time bins.  For spectra
and detector images / histograms, the TIME column always refers to the
start of the accumulation time.  In some cases, a separate keyword or
column named TSTOP or TIME_STOP is used to indicate the stop of the
accumulation time.

<p>
For light curves, the start, stop and center times of each bin can be
calculated as:
</p><pre>
   TIME_START = TIME - TIMEPIXR*TIMEDEL
   TIME_STOP  = TIME + (1-TIMEPIXR)*TIMEDEL
   TIME_CENT  = TIME + (0.5-TIMEPIXR)*TIMEDEL
</pre>
<p>
When the user specifies timepixr=0.5, the TIME column marks the center
of each bin, and TIME_START and TIME_STOP are one-half of a bin width
away.  If variable size time bins are requested, then TIMEDEL will be a
column instead of a keyword, but the above expressions still hold.

<h3>TIME SELECTION</h3>

<p>
By default, the input file is selected according to its own internal
good time intervals, if any are present.
</p>

<p>
Crude time selection can be performed using the tstart and tstop
parameters to the task, which give the start and stop times of
accumulation.
</p>

<p>
More refined selections can be performed specifying the gtifile
parameter.  A good time interval file (GTI) describes an arbitrary
number of intervals by specifying the start and stop times.  The
intersection of the input files' GTIs, the user-provided gtifile, and
the user-provided tstart/tstop parameters, are used to select input
data by time.  For input DPH (survey) data, the time interval of each
input DPH must overlap with the total good time intervals by a large
enough amount, and must never straddle more than one output bin.
</p>

<p>
The DPH overlap time required is determined by the
min_dph_frac_overlap, min_dph_time_overlap and max_dph_time_nonoverlap
parameters.  Care should be taken when altering the overlap
parameters, especially when the properties of the source and the
background are not constant with time.  For example, if a source
becomes earth-occulted during the DPH, and a corresponding occultation
GTI was input to batbinevt, then the background will have the full
exposure, but the source will only have a fractional exposure,
i.e. the exposure is ambiguous.  For exposure purposes, batbinevt
records the full exposure of all DPHs that pass the overlap tests,
including any non-overlap intervals.  The output GTI, however, retains
the user-requested good time intervals.
</p>

<h3>FLUX UNCERTAINTIES</h3>

<p>
batbinevt assumes that detector counts are Poisson-distributed, and
propagates the errors to the output.  However, if the input is a
modeled background (e.g. from batclean), then the output uncertainties
will be set to zero.  This behavior is governed by the HDUCLAS2
keyword in the input DPH file: modeled background maps should have
HDUCLAS2 = 'PREDICTED'.
</p>

<h3>OUTPUT FORMATS</h3>

<p>
Generally speaking, the formats of the output files should be
compatible with OGIP-standard software, where applicable.  The output
columns are described below.  Some columns appear only with certain
output types, indicated by the "Outtype" phrase.  The units and data
type are also given.

<dl>
<dt>TIME</dt><dd>Time label for each row (Mission Elapsed Time).  The TIME column may mark the beginning, center or end of the time bin, depending on the 'timepixr' parameter. Outtype=LC,PHA2; Unit=s; Type=D.</dd>
<dt>TIME_STOP</dt><dd>Stop time for each row (Mission Elapsed Time).  Image and spectral types have this column.  Outtype=PHA2,DPITAB,DPH; Unit=s; Type=D.</dd>
<dt>RATE/COUNTS</dt><dd>Binned count data.  The name and units depend on the 'outunits' parameter.  The format may be scalar or vector, depending on the output file type. Outtype=LC,PHA,PHA2; Unit=count/s or count; Type=D.</dd>
<dt>ERROR/STAT_ERR</dt><dd>Poisson uncertainty in the RATE/COUNTS value (light curves use ERROR, spectra use STAT_ERR). Outtype=LC,PHA,PHA2; Unit=(same as RATE/COUNTS); Type=D.</dd>
<dt>TOTCOUNTS</dt><dd>The total number of counts processed for a given row. Outtype=LC,PHA2; Unit=count; Type=D.</dd>
<dt>FRACEXP</dt><dd>The fractional exposure of this row (a value from 0.0 to 1.0).  This is the intersection of the user and file GTIs, and the time interval of the row. Outtype=LC; Unit=fraction; Type=D.</dd>
<dt>TIMEDEL/TELAPSE</dt><dd>The STOP-START time bin size of each row, when the rows have variable time bin sizes.  Light curves use TIMEDEL and spectra use TELAPSE.  If the bin size is constent, then TIMEDEL/TELAPSE is a keyword. Outtype=LC,PHA2; Unit=s; Type=D.</dd>
<dt>EXPOSURE</dt><dd>The total exposure for the row for image and spectral types.  Outtype=PHA2,DPITAB,DPH; Unit=s; Type=D.</dd>
<dt>SPEC_NUM</dt><dd>Spectrum label number, one for each row. Outtype=PHA2; Unit=none; Type=J.</dd>
<dt>CHANNEL</dt><dd>A numerical label for each pulse height bin. Outtype=PHA,PHA2; Unit=none; Type=I.</dd>
<dt>DPH_COUNTS</dt><dd>The Detector Plane Histogram counts. This may be either a cube (DPH) or a 2-d matrix (DPITAB). Outtype=DPITAB,DPH; Unit=count; Type=E.</dd>
<dt>E_MIN/E_MAX</dt><dd>The min/max bin edges for each bin in a Detector Plane Image. Outtype=DPITAB; Unit=keV; Type=D.</dd>
<dt>DPH_LEVEL</dt><dd>The energy bin number when multiple energy DPI slices are requested. Outtype=DPI; Unit=none; Type=J.</dd>
</dl>

<h2>PARAMETERS</h2>
<dl>

<dt>infile [filename]

<dd>Input file name or names, containing BAT event or DPH data.  This
may be a comma-delimited list of names, or the name of a text file
containing a list of file names, one per line, preceded by an '@'
character.
<p>

<dt>outfile [filename]

<dd>Output light curve or spectrum file name.
<p>

<dt>outtype [string]

<dd>Chooses output format of either light curve (outtype="LC"),
spectrum (outtype="PHA", "PHA1", "PHA2"), 
detector plane histogram (outtype="DPH"),
detector plane image (outtype="DPI"), or detetector plane image table
(outtype="DPITAB").  The difference between DPI and DPITAB is that DPI
output has one detector image per FITS image extension and the later
has one image per FITS row in a single extension.
<p>

<dt>timedel = 1.0 [real]

<dd>Select a time bin size, in seconds.  If time binning is uniform,
then a value of timedel=0.0 causes the tool to accumulate all data
into a single time bin.  The value of timedel has a special meaning
if the time binning algorithm is "snr" (timedel = maximum time bin size)
or "highsnr" (timedel = minimum time bin size).  See above for more 
information.
<p>

<dt>timebinalg = uniform [string]

<dd>One of "uniform", for uniform binning, "snr", for constant signal
to noise ratio, "gti" for time binning according to the intervals in
the GTI file, "infile" to mimic the input file binning (binned input
data only), or "matchlc" to match an existing light curve.  Only the
first character of the algorithm type needs to be specified.
<p>

<dt>energybins = "-" [string]

<dd>Energy bin ranges, expressed as a comma-separated list of floating
point number ranges, a file name containing energy bin ranges,
INFILE, FILEBINS or CALDB.  
<dl>
<dt>Comma-separated list
<dd>
Each bin in the comma-separated list is specified
as EMIN1-EMAX1,EMIN2-EMAX2,... (in units of keV).  Pulse heights which
satisfy EMIN[n] &le; E &lt; EMAX[n] are considered to be in bin n.
If EMIN[n] is missing, then it is assumed to be 0.  If EMAX[n] is missing
it is assumed to be the maximum energy.
A value of "-" indicates single
all-inclusive energy bin.  At least one bin must be given to make even
a light curve, and bins must not overlap.  
<dt>File name
<dd>The name of a FITS file with an EBOUNDS extension (such as a
response matrix), containing columns E_MIN and E_MAX (in keV), or an
ASCII file containing a comma-separated energy bin list as described
above.
<dt>FILEBINS or INFILE
<dd>FILEBINS or INFILE indicates that the energy binning of the first input
file is used. (this only applies when the inputs are DPHs, and the DPH
must have an EBOUNDS extension).
<dt>CALDB
<dd>If CALDB is
specified, then the CALDB database is consulted for energy bins.  A
standard 4-channel and 80-channel set of binnings is chosen depending
on whether the outtype is LC or PHA, respectively.  By using CALDB:n,
a specific n-channel binning can be selected (provided it exists in
CALDB).
</dl>
<p>

<dt>(gtifile = NONE) [string]

<dd>Name of goodtime interval file or time bin file.  If the time
binning algorithm is "gti" or "matchlc" then this file is used to
establish the time bins.  Normally, this file is a standard GTI.
However, for time binning algorithm "matchlc", this file should be
standard OGIP light curve.  The user-supplied good times are logically
intersected with the good times of the input files (i.e. only overlap
portions are used).  The default of NONE implies that all good time
intervals from the input files will be used.  
<p>

<dt>(ecol = PI) [string]

<dd>Column name to use for the energy value.  The default is the
energy computed in the "PI" column, but it is possible to choose
another column name such as "PHA".
<p>

<dt>(weighted = INDEF) [string]

<dd>Set to boolean yes or no (or INDEF), depending on whether mask
weighting should be applied to the binning operation.  A value of "no"
indicates that all counts should be unweighted (unity weight).  A value
of INDEF depends on outtype.  If outtype is LC or PHA, then INDEF
signifies that "yes," weighting should be applied; for output types
DPH, DPI or DPITAB, then INDEF means "no" weighting should be applied.
<p>

<dt>(outunits = INDEF) [string]

<dd>Set to RATE, COUNTS or INDEF, depending on whether the output
histogram units should be "count/s", "count", or automatically
determined (INDEF).  When INDEF is specified, outunit depends on
outype.  If outtype is LC or PHA, then INDEF signifies "RATE;" for
output types DPH, DPI or DPITAB, then INDEF means "COUNTS."  Note that
not all combinations are meaningful.
<p>

<dt>(timepixr = -1.0) [real]

<dd>Determines the reference point of each time bin for light curves
only.  A value of 0.0 (0.5) indicates that the TIME column refers to
the start (center) of each time bin.  A special value of -1 (the
default) specifies that timepixr=0.0 for uniformly binned light curves
and timepixr=0.5 for non-unformly binned light curves.  This parameter
does not have any affect for spectra, images or DPHs.

<dt>(maskwt = NONE) [string]

<dd>Mask weight map file.  This file should contain a mask weight
image for the detector plane, and if given, overrides any mask
weighting found in the infile.
<p>

<dt>(tstart = INDEF) [string]

<dd>Start time of the accumulation, in seconds, expressed in Mission
Elapsed Time.  Default value (INDEF) implies using the TSTART/TSTOP
keywords from the input file.
<p>

<dt>(tstop = INDEF) [string]

<dd>Stop time of the accumulation, in seconds, expressed in Mission
Elapsed Time.  Default value (INDEF) implies using the TSTART/TSTOP
keywords from the input file.
<p>

<dt>(snrthresh = 6.0) [real]

<dd>For the constsnr binning method, the signal to noise ratio to
require for each time bin.  If there is more than one energy bin
selected, the threshold refers to the signal to noise ratio for the
sum of all energy bins.
<p>

<dt>(detmask = "NONE") [string]

<dd>Name of a detector quality map file.  This should be an image file
with the same dimensions as the detector plane map.  A pixel value of
0 indicates the detector is enabled for imaging, and a non-zero value
indicates disabled.  A default value of NONE implies all detectors are
on, except for the BAT detector gap regions.
<p>

<dt>(tcol = "TIME") [string]

<dd>Name of TIME column in input file.
<p>

<dt>(countscol = "DPH_COUNTS") [string]

<dd>Name of counts column column in input file (column 'DPH_COUNTS'
containing detector counts histogram when reading DPH data).
<p>

<dt>(xcol = "DETX") [string]

<dd>Name of X column in input file (event data).
<p>

<dt>(ycol = "DETY") [string]

<dd>Name of Y column in input file (event data).
<p>

<dt>(maskwtcol = "MASK_WEIGHT") [string]

<dd>Name of MASK_WEIGHT column in input file (event data).
<p>

<dt>(ebinquant = 0.1) [real]

<dd>Default energy bin quantization, in keV, if none is specified in
the input event file.  Most BAT input events are quantized with 0.1
keV step sizes using the TSCALn keyword.  If no such keywords are
found, then ebinquant is used.  This value should represent the
minimum possible energy bin size of the instrument.
<p>

<dt>(delzeroes = "NO") [boolean]

<dd>Delete time bins with zero flux?  If yes, then any bin which has
no counts, or all counts with zero weights, will be removed from the
output.  For multi-channel output data types, the time bin will only
be deleted if all spatial/spectral bins contain zero.  If
delzeroes="NO", then the output may contain bins with zero flux.  The
error bars will be zero too for those cases, which may cause
subsequent processing to fail.
<p>

<dt>(minfracexp = 0.1) [real]

<dd>The minimum fractional exposure.  Time bins with smaller
fractional exposure are deleted before creating the output.  To
preserve all time bins, even bins with zero exposure, set
minfracexp=0.  Bins with no exposure will have null COUNTS / RATE.
<p>

<dt>(min_dph_frac_overlap = 0.999) [real]

<dd>The minimum fractional exposure per individual DPH in the input
file.  The combined set of all good time intervals must fractionally
overlap with a DPH by at least mindphfracoverlap, or else the DPH row
is rejected.  The default value of 0.999 allows for a small
non-overlap as well as numerical round-off issues.
<p>

<dt>(min_dph_time_overlap = 0) [real]

<dd>The minimum time overlap, in seconds, per individual DPH in the
input file.  The combined set of all good time intervals must overlap
with the DPH by at least mindphtimeoverlap duration, or else the DPH
row is rejected.  This is also equivalent to a filter on the minimum
exposure time per individual DPH.  The default value of 0 indicates
that any number of seconds is allowed -- but the fractional overlap
test (mindphfracoverlap) must also pass.
<p>

<dt>(max_dph_time_nonoverlap = 0.5) [real]

<dd>The maximum non-overlap time, in seconds, allowed per individual
DPH in the input file.  After intersecting the combined set of all
good times and the individual DPH time interval, the remaining
non-overlapping time must be no more than maxdphtimenonoverlap
seconds, or else the DPH row is rejected.  A larger number is a more
liberal acceptance criterium.  The default value of 0.5 seconds,
allows for a small amount of non-overlap between the good time
intervals and the survey DPH.
<p>

<dt>(buffersize = 32768) [integer]

<dd>Size of internal event buffer for processing.
<p>

<dt>(clobber = NO) [boolean]

<dd>If the output file already exists, then setting "clobber = yes" will cause it to be overwritten.
<p>

<dt>(chatter = 2) [integer, 0 - 5]

<dd>Controls the amount of informative text written to standard
output.  Setting chatter = 1 produces a basic summary of the task
actions; chatter = 2 (default) additionally prints a summary of input
parameters; chatter = 5 prints debugging information.
<p>

<dt>(history = YES) [boolean]

<dd>If history = YES, then a set of HISTORY keywords will be written to
the header of the specified HDU in the output file to record the value
of all the task parameters that were used to produce the output
file.

</dl>
<h2>EXAMPLES</h2>

<h3>MAKING LIGHT CURVES from EVENT DATA</h3>

<p>
1. Uniform binning of 0.1 seconds in the 15-195 keV energy range
(light curve is weighted i.e. background subtracted)
</p><pre>
     batbinevt infile.evt outfile.lc LC 0.1 uniform 15-195
</pre>
<p>
("uniform" binning means uniformly sampled (=0.1s) bins)
<p>
2. Two-band light light curve for 15-50 and 50-195 keV
(otherwise same as above)
</p><pre>
     batbinevt infile.evt outfile.lc LC 0.1 uniform 15-50,50-195
</pre>
<p>
(the energy bins can be specified as either an ASCII list or a file
name with the energy bins)
<p>
3. Binning by constant signal to noise (threshold = 6 sigma)
</p><pre>
     batbinevt infile.evt outfile.lc LC 0 snr 15-195 snrthresh=6.0
</pre>
<p>
(When the "snr" time binning method is specified, a zero time
binning is ignored.)
<p>

4. Binning by constant signal to noise (threshold = 6 sigma, maximum
bin size of 10 seconds)
</p><pre>
     batbinevt infile.evt outfile.lc LC 10 snr 15-195 snrthresh=6.0
</pre>
<p>
(When the "snr" time binning method is specified, a non-zero time
binning indicates the maximum bin size that is imposed.)
<p>

5. Selecting the times by hand (0.1 second uniform bins, 15-195 keV)
</p><pre>
     batbinevt infile.evt outfile.lc LC 0.1 uniform 15-195 tstart=$START tstop=$STOP
</pre>
<p>
(only include data from $START to $STOP)
<p>
6. Applying your own binning (0.1 second uniform bins, 15-195 keV)
(must make a Good Time Interval (GTI) named mygti.gti)
</p><pre>
     batbinevt infile.evt outfile.lc LC 0.1 gti 15-195 gtifile=mygti.gti
</pre>
<p>
(The "gti" time binning means that the bins are taken from the GTI
file.  When the time binning is not "gti" the GTI file is still
useful to select data by time.)
<p>

7. Unweighted light curve (with no background subtraction)
</p><pre>
     batbinevt infile.evt outfile.lc LC 0.1 uniform 15-195 weighted=no
</pre>
<p>
(The weighted parameter decides whether mask weighting is applied
or not.)
<p>


8. Change output units to counts instead of counts/s.
</p><pre>
     batbinevt infile.evt outfile.lc LC 0.1 uniform 15-195 outunits=count
</pre>
<p>
(The outunits parameter can be either COUNT or RATE.)
<p>

<h3>MAKING SPECTRA from EVENT DATA</h3>
<p>
9. Total spectrum, in user-specified energy bins
</p><pre>
      batbinevt infile.evt outfile.pha PHA 0 uniform 15-25,25-50,50-100,100-195
</pre>
<p>
(A time bin size of 0 means that the entire data set should be
accumulated into one total spectrum.
<p>

The energy bins can be specified as either an ASCII list or a file
name with the energy bins.  With a few bins it is easier to give
an ASCII list.)
<p>

10. Total spectrum, with energy bins given by EBOUNDS extension in
myebounds.fits
</p><pre>
      batbinevt infile.evt outfile.pha PHA 0 uniform myebounds.fits
</pre>
<p>
(Here the energy bins are given in a file with an EBOUNDS extension.)
<p>

11. Spectrum every 100 seconds, using EBOUNDS extension
</p><pre>
      batbinevt infile.evt outfile.pha PHA 100.0 uniform myebounds.fits
</pre>
<p>
12. Binning by constant signal to noise (threshold = 6 sigma)
</p><pre>
     batbinevt infile.evt outfile.pha PHA 0 snr myebounds.fits snrthresh=6.0
</pre>
<p>
(The threshold applies to total spectrum, not any one bin.)
<p>

13. Selecting the times by hand 
</p><pre>
     batbinevt infile.evt outfile.pha PHA 0 uniform myebounds.fits tstart=$START tstop=$STOP
</pre>
<p>
(Only includes data from $START to $STOP)
<p>
14. Applying your own binning, say from Bayesian Blocks analysis
(must make a Good Time Interval (GTI) named mygti.gti)
</p><pre>
     batbinevt infile.evt outfile.pha PHA 0 gti myebounds.fits gtifile=mygti.gti
</pre>
<p>
(The "gti" time binning means that the bins are taken from the GTI
file.  When the time binning is not "gti" the GTI file is still
useful to select data by time.)
<p>
15. Unweighted spectrum (with no background subtraction)
</p><pre>
     batbinevt infile.evt outfile.pha PHA 0 uniform myebounds.fits weighted=no
</pre>
<p>
(The weighted parameter decides whether mask weighting is applied
or not.)
<p>
16. Change output units to counts instead of counts/s.
</p><pre>
     batbinevt infile.evt outfile.pha PHA 0 uniform myebounds.fits outunits=count
</pre>
<p>
(The outunits parameter can be either COUNT or RATE.)
<p>

<h3>MAKING LIGHT CURVES and SPECTRA from DPHs</h3>
<p>
17. Accumulate mask weighted light curve from DPH (must have generated
mask weight image maskwt.img for source position of interest)
</p><pre>
     batbinevt infile.dph outfile.lc LC 0 infile 14.0-194.9 maskwt=maskwt.img
</pre>
<p>
(Note that energy bins must be exact to within 0.1 keV.  The
"infile" for the time binning algorithm indicates that the input
file binning should be replicated in the output.)
<p>
18. Accumulate total mask weighted spectrum from DPH
</p><pre>
     batbinevt infile.dph outfile.pha PHA 0 uniform infile.dph maskwt=maskwt.img
</pre>
<p>
(Note that EBOUNDS extension from infile is used to generate energy
bin edges.)
<p>
19. Accumulate total mask weighted spectrum with user-designed bins
</p><pre>
     batbinevt infile.dph outfile.pha PHA 0 gti infile.dph maskwt=maskwt.img
</pre>
<p>
20. Accumulate raw light curve from DPH (no mask weighting)
</p><pre>
     batbinevt infile.dph outfile.lc LC 0 infile 14.0-194.9 weighted=no
</pre>
<p>
21. Accumulate raw spectrum from DPH (no mask weighting)
</p><pre>
     batbinevt infile.dph outfile.pha PHA 0 uniform infile.dph weighted=no
</pre>
<p>
<h3>MAKING DPHs and DPIs from EVENT DATA</h3>
<p>
22. Make total DPH from event data
</p><pre>
     batbinevt infile.evt outfile.dph DPH 0 uniform myebounds.fits
</pre>
<p>
(myebounds.fits should contain the desired energy binning.  A time
bin size of 0 indicates that the total DPH should be constructed.)
<p>

23. Make total DPI from event data (15-195 keV)
</p><pre>
     batbinevt infile.evt outfile.dpi DPI 0 uniform 15-195
</pre>
<p>
24. Make many DPIs from event data (100 second binning)
</p><pre>
     batbinevt infile.evt outfile.dpi DPI 100 uniform 15-195
</pre>
<p>
(Output file is stored as one DPI per image extension.)  One can
also use:
<pre>
     batbinevt infile.evt outfile.dpi DPITAB 100 uniform 15-195
</pre>
<p>
(which will put many DPIs into one extension as a table.)
<p>
25. Making DPHs from event data is accomplished with this command
</p><pre>
     batbinevt infile.evt outfile.dph DPH 0 uniform myebounds.fits
</pre>
<p>
(making more than one or two DPHs in this way is not recommended,
since it requires a large amount of computer memory).
<p>
<h3>MANIPULATING and FLATTENING DPHs</h3>
<p>
batbinevt can be used to "flatten" detector plane histograms in
various ways.  
<p>
26. Make total DPH (add all DPH rows into a single DPH row).
</p><pre>
     batbinevt infile.dph outfile.dph DPH 0 uniform infile.dph
</pre>
<p>
(The energy binning of infile.dph means that the energy binning of
the input file is preserved in the output).
<p>
27. Make total DPI (add all DPH rows into a single detector image).
</p><pre>
     batbinevt infile.dph outfile.dpi DPI 0 uniform 14.0-194.9
</pre>
<p>
(Only energies from 14.0-194.9 are kept in the detector image.)
<p>
28. Make one DPI for each DPH (flatten by energy)
</p><pre>
     batbinevt infile.dph outfile.dpi DPITAB 0 infile 14.0-194.9
</pre>
<p>
("infile" time binning indicates to preserve input file time bins.
The output file is a table of DPIs, one per FITS row).  This
command creates one DPI per image extension.
</p><pre>
     batbinevt infile.dph outfile.dpi DPI 0 infile 14.0-194.9
</pre>
<p>
(either is compatible with the batfftimage imaging software)
<p>
29. Make new DPHs by collapsing some energy bins.  This command makes
approximate bins from 15-25,25-50,50-100 and 100-200 keV.
</p><pre>
     batbinevt infile.dph outfile.dph DPH 0 infile 14-26,26-51.1,51.1-101.2,101.2-194.9
</pre>
<p>
(Note energy bins must agree to within 0.1 keV of input binning)
<p>
It is not advisable to make more than one full-sized (>80 energy
channels) DPH because the memory storage requirements are
prohibitive.
<p>
<h2>SEE ALSO</h2>

<p>
<a href="extractor.txt">extractor</a>, 
<a href="batmaskwtevt.html">batmaskwtevt</a>, 
<a href="batmaskwtimg.html">batmaskwtimg</a>

<h2>LAST MODIFIED</h2>

Nov 2007
</body>
</html>
