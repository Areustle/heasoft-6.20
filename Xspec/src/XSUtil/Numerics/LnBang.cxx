#include <XSUtil/Numerics/LnBang.h>
#include <cmath>

namespace Numerics {

   const int LnBang::s_NCOEFF = 6;
   const Real LnBang::s_coeff[LnBang::s_NCOEFF] = {
      76.18009172947146 , -86.50532032941677 , 
      24.01409824083091 , -1.231739572450155 , 
      0.1208650973866179e-2 , -.5395239384953e-5
   };
   const Real LnBang::s_step = 2.5066282746310005;
   const int LnBang::s_NFACT = 1001;
   const Real LnBang::s_logFact[LnBang::s_NFACT] = {
      // logFact 0-44
      0.00000000000000, 0.00000000000000, 0.69314718246460, 
      1.79175949096680, 3.17805385589600, 4.78749179840088,
      6.57925128936768, 8.52516138553619, 10.6046029329300,
      12.8018275499344, 15.1044126749039, 17.5023080110550,
      19.9872146844864, 22.5521639585495, 25.1912213563919,
      27.8992716073990, 30.6718603372574, 33.5050736665726,
      36.3954454660416, 39.3398844003677, 42.3356167078018,
      45.3801392316818, 48.4711817502975, 51.6066759824753,
      54.7847298383713, 58.0036057233810, 61.2617021799088,
      64.5575391054153, 67.8897436857224, 71.2570394277573,
      74.6582368612289, 78.0922240018845, 81.5579599142075,
      85.0544675588608, 88.5808280706406, 92.1361762285233,
      95.7196952104568, 99.3306130170822, 102.968199133873,
      106.631760716438, 110.320640206337, 114.034212231636,
      117.771881937981, 121.533082127571, 125.317271828651,
      // logFact 45-89
      129.123934388161, 132.952575802803, 136.802723288536,
      140.673924326897, 144.565744519234, 148.477767586708,
      152.409593224525, 156.360836863518, 160.331128716469,
      164.320112824440, 168.327446103096, 172.352797627449,
      176.395848870277, 180.456291794777, 184.533829331398,
      188.628173947334, 192.739047646523, 196.866181969643,
      201.009316563606, 205.168199658394, 209.342587113380,
      213.532241940498, 217.736934781075, 221.956442475319,
      226.190549015999, 230.439044117928, 234.701724171638,
      238.978390336037, 243.268849968910, 247.572915196419,
      251.890403389931, 256.221136689186, 260.564942002296,
      264.921651005745, 269.291098713875, 273.673125386238,
      278.067574620247, 282.474293828011, 286.893134236336,
      291.323950886726, 295.766602158546, 300.220949292183,
      304.686857342720, 309.164194226265, 313.652830719948,
      // logFact 90-134
      318.152640461922, 322.663499951363, 327.185288548470,
      331.717887997627, 336.261182904243, 340.815059781075,
      345.379408001900, 349.954118847847, 354.539086461067,
      359.134206414223, 363.739376664162, 368.354497075081,
      372.979469895363, 377.614198803902, 382.258589863777,
      386.912550091743, 391.575989365578, 396.248818039894,
      400.930949330330, 405.622297406197, 410.322777867317,
      415.032308220863, 419.750806927681, 424.478194832802,
      429.214393258095, 433.959325432777, 438.712915539742,
      443.475089669228, 448.245774388313, 453.024897694588,
      457.812389492989, 462.608180165291, 467.412201046944,
      472.224385380745, 477.044666886330, 481.872980713844,
      486.709262490273, 491.553449749947, 496.405480027199,
      501.265292286873, 506.132826924324, 511.008024334908,
      515.890826344490, 520.781175255775, 525.679015278816,
      // logFact 135-179
      530.584290146828, 535.496945023537, 540.416926026344,
      545.344179749489, 550.278653740883, 555.220296025276,
      560.169056057930, 565.124883294106, 570.087728142738,
      575.057541489601, 580.034275174141, 585.017881989479,
      590.008314728737, 595.005527138710, 600.009473443031,
      605.020108819008, 610.037388443947, 615.061268925667,
      620.091706871986, 625.128659367561, 630.172084450722,
      635.221940636635, 640.278186440468, 645.340781331062,
      650.409685730934, 655.484859585762, 660.566263794899,
      665.653860211372, 670.747610211372, 675.847476601601,
      680.953422188759, 686.065409779549, 691.183403611183,
      696.307367444038, 701.437265992165, 706.573064446449,
      711.714727997780, 716.862222313881, 722.015514016151,
      727.174569249153, 732.339355111122, 737.509839177132,
      742.685989022255, 747.867772698402, 753.055158734322,
      // logFact 180-224
      758.248115658760, 763.446612477303, 768.650619149208,
      773.860105156898, 779.075040936470, 784.295396924019,
      789.521143555641, 794.752252221107, 799.988694310188,
      805.230441212654, 810.477465271950, 815.729738831520,
      820.987234234810, 826.249924302101, 831.517782330513,
      836.790782094002, 842.068896889687, 847.352100491524,
      852.640367627144, 857.933672547340, 863.231989979744,
      868.535294651985, 873.843562245369, 879.156768441200,
      884.474888443947, 889.797898411751, 895.125774502754,
      900.458493351936, 905.796031594276, 911.138365864754,
      916.485473275185, 921.837331414223, 927.193917870522,
      932.555210232735, 937.921186089516, 943.291823983192,
      948.667102456093, 954.046999573708, 959.431494832039,
      964.820566773415, 970.214194417000, 975.612357258797,
      981.015034794807, 986.422206521034, 991.833852410316,
      // logFact 225-269
      997.249952912331, 1002.67048799992, 1008.09543812275,
      1013.52478373051, 1018.95850574970, 1024.39658510685,
      1029.83900272846, 1035.28574001789, 1040.73677837849,
      1046.19209969044, 1051.65168535709, 1057.11551725864,
      1062.58357727528, 1068.05584776402, 1073.53231108189,
      1079.01295006275, 1084.49774706364, 1089.98668491840,
      1095.47974646091, 1100.97691452503, 1106.47817289829,
      1111.98350441456, 1117.49289286137, 1123.00632154942,
      1128.52377426624, 1134.04523527622, 1139.57068836689,
      1145.10011732578, 1150.63350689411, 1156.17084133625,
      1161.71210491657, 1167.25728237629, 1172.80635845661,
      1178.35931789875, 1183.91614592075, 1189.47682774067,
      1195.04134809971, 1200.60969269276, 1206.18184673786,
      1211.75779592991, 1217.33752596378, 1222.92102205753,
      1228.50827085972, 1234.09925806522, 1239.69396936893,
      // logFact 270-314
      1245.29239141941, 1250.89451038837, 1256.50031244755,
      1262.10978424549, 1267.72291243076, 1273.33968365192,
      1278.96008455753, 1284.58410227299, 1290.21172344685,
      1295.84293520451, 1301.47772467136, 1307.11607944965,
      1312.75798666477, 1318.40343344212, 1324.05240786076,
      1329.70489704609, 1335.36088907719, 1341.02037107944,
      1346.68333160877, 1352.34975826740, 1358.01963913441,
      1363.69296228886, 1369.36971628666, 1375.04988873005,
      1380.73346865177, 1386.42044413090, 1392.11080372334,
      1397.80453598499, 1403.50162947178, 1409.20207321644,
      1414.90585577488, 1420.61296617985, 1426.32339298725,
      1432.03712570667, 1437.75415337086, 1443.47446501255,
      1449.19805014133, 1454.92489778996, 1460.65499746799,
      1466.38833868504, 1472.12491095066, 1477.86470377445,
      1483.60770714283, 1489.35391056538, 1495.10330355167,
      // logFact 315-359
      1500.85587608814, 1506.61161816120, 1512.37051975727,
      1518.13257133961, 1523.89776241779, 1529.66608345509,
      1535.43752443790, 1541.21207582951, 1546.98972809315,
      1552.77047169209, 1558.55429708958, 1564.34119427204,
      1570.13115465641, 1575.92416822910, 1581.72022593021,
      1587.51931869984, 1593.32143700123, 1599.12657177448,
      1604.93471443653, 1610.74585545063, 1616.55998575687,
      1622.37709677219, 1628.19717991352, 1634.02022564411,
      1639.84622585773, 1645.67517149448, 1651.50705397129,
      1657.34186470509, 1663.17959511280, 1669.02023661137,
      1674.86378109455, 1680.71021997929, 1686.55954468250,
      1692.41174709797, 1698.26681911945, 1704.12475216389,
      1709.98553860188, 1715.84916985035, 1721.71563780308,
      1727.58493483067, 1733.45705282688, 1739.33198368549,
      1745.20971930027, 1751.09025251865, 1756.97357475758,
      // logFact 360-404
      1762.85967886448, 1768.74855673313, 1774.64020073414,
      1780.53460371494, 1786.43175756931, 1792.33165514469,
      1798.23428833485, 1804.13964998722, 1810.04773294926,
      1815.95852959156, 1821.87203276157, 1827.78823482990,
      1833.70712864399, 1839.62870705128, 1845.55296289921,
      1851.47988903522, 1857.40947830677, 1863.34172356129,
      1869.27661764622, 1875.21415388584, 1881.15432512760,
      1887.09712469578, 1893.04254543781, 1898.99058020115,
      1904.94122278690, 1910.89446604252, 1916.85030329227,
      1922.80872786045, 1928.76973307133, 1934.73331224918,
      1940.69945919514, 1946.66816675663, 1952.63942873478,
      1958.61323845387, 1964.58958923817, 1970.56847488880,
      1976.54988920689, 1982.53382551670, 1988.52027761936,
      1994.50923883915, 2000.50070345402, 2006.49466478825,
      2012.49111664295, 2018.49005329609, 2024.49146807194,
      // logFact 405-449
      2030.49535524845, 2036.50170862675, 2042.51052200794,
      2048.52178919315, 2054.53550446033, 2060.55166161060,
      2066.57025492191, 2072.59127819538, 2078.61472570896,
      2084.64059174061, 2090.66887009144, 2096.69955551624,
      2102.73264181614, 2108.76812326908, 2114.80599415302,
      2120.84624874592, 2126.88888180256, 2132.93388712406,
      2138.98125946522, 2145.03099310398, 2151.08308231831,
      2157.13752186298, 2163.19430601597, 2169.25342905521,
      2175.31488621235, 2181.37867128849, 2187.44477951527,
      2193.51320517063, 2199.58394300938, 2205.65698730946,
      2211.73233330250, 2217.80997574329, 2223.88990890980,
      2229.97212803364, 2236.05662739277, 2242.14340221882,
      2248.23244726658, 2254.32375729084, 2260.41732704639,
      2266.51315176487, 2272.61122620106, 2278.71154510975,
      2284.81410372257, 2290.91889679432, 2297.02591955662,
      // logFact 450-494
      2303.13516724110, 2309.24663460255, 2315.36031687260,
      2321.47620880604, 2327.59430611134, 2333.71460354328,
      2339.83709633350, 2345.96177971363, 2352.08864891529,
      2358.21769917011, 2364.34892570972, 2370.48232376575,
      2376.61788856983, 2382.75561583042, 2388.89550030231,
      2395.03753769398, 2401.18172323704, 2407.32805263996,
      2413.47652113438, 2419.62712395191, 2425.77985680103,
      2431.93471491337, 2438.09169399738, 2444.25078928471,
      2450.41199648380, 2456.57531130314, 2462.74072897434,
      2468.90824568272, 2475.07785618305, 2481.24955666065,
      2487.42334282398, 2493.59920990467, 2499.77715408802,
      2505.95717060566, 2512.13925564289, 2518.32340443134,
      2524.50961315632, 2530.69787704945, 2536.88819229603,
      2543.08055460453, 2549.27496016026, 2555.47140419483,
      2561.66988289356, 2567.87039196491, 2574.07292759418,
      // logFact 495-539
      2580.27748548985, 2586.48406136036, 2592.69265139103,
      2598.90325129032, 2605.11585724354, 2611.33046543598,
      2617.54707157612, 2623.76567184925, 2629.98626196384,
      2636.20883810520, 2642.43339645863, 2648.65993320942,
      2654.88844406605, 2661.11892569065, 2667.35137379169,
      2673.58578455448, 2679.82215416431, 2686.06047880650,
      2692.30075466633, 2698.54297792912, 2704.78714478016,
      2711.03325140476, 2717.28129446507, 2723.53126966953,
      2729.78317368031, 2736.03700268269, 2742.29275286198,
      2748.55042040348, 2754.81000196934, 2761.07149374485,
      2767.33489191532, 2773.60019314289, 2779.86739361286,
      2786.13648998737, 2792.40747845173, 2798.68035566807,
      2804.95511782169, 2811.23176109791, 2817.51028263569,
      2823.79067862034, 2830.07294523716, 2836.35707962513,
      2842.64307749271, 2848.93093597889, 2855.22065174580,
      // logFact 540-584
      2861.51222097874, 2867.80564033985, 2874.10090649128,
      2880.39801561832, 2886.69696485996, 2892.99775087833,
      2899.30036985874, 2905.60481846333, 2911.91109383106,
      2918.21919214725, 2924.52911055088, 2930.84084522724,
      2937.15439331532, 2943.46975147724, 2949.78691637516,
      2956.10588467121, 2962.42665302753, 2968.74921810627,
      2975.07357704639, 2981.39972651005, 2987.72766315937,
      2994.05738413334, 3000.38888609409, 3006.72216570377,
      3013.05722010136, 3019.39404594898, 3025.73263990879,
      3032.07299911976, 3038.41512072086, 3044.75900137424,
      3051.10463774204, 3057.45202696323, 3063.80116617680,
      3070.15205204487, 3076.50468122959, 3082.85905134678,
      3089.21515905857, 3095.57300150394, 3101.93257534504,
      3108.29387772083, 3114.65690577030, 3121.02165663242,
      3127.38812696934, 3133.75631392002, 3140.12621510029,
      // logFact 585-629
      3146.49782717228, 3152.87114679813, 3159.24617159367,
      3165.62289869785, 3172.00132477283, 3178.38144743443,
      3184.76326334476, 3191.14677011967, 3197.53196442127,
      3203.91884386539, 3210.30740511417, 3216.69764578342,
      3223.08956301212, 3229.48315393925, 3235.87841570377,
      3242.27534544468, 3248.67394030094, 3255.07419788837,
      3261.47611486912, 3267.87968885899, 3274.28491747379,
      3280.69179737568, 3287.10032618046, 3293.51050102711,
      3299.92231953144, 3306.33577835560, 3312.75087511539,
      3319.16760742664, 3325.58597242832, 3332.00596725941,
      3338.42758953571, 3344.85083639622, 3351.27570545673,
      3357.70219385624, 3364.13029921055, 3370.56001865864,
      3376.99134981632, 3383.42428982258, 3389.85883629322,
      3396.29498684406, 3402.73273861408, 3409.17208921909,
      3415.61303579807, 3422.05557596684, 3428.49970734119,
      // logFact 630-674
      3434.94542706013, 3441.39273273945, 3447.84162199497,
      3454.29209244251, 3460.74414122105, 3467.19776642323,
      3473.65296518803, 3480.10973465443, 3486.56807291508,
      3493.02797758579, 3499.48944580555, 3505.95247519016,
      3512.41706335545, 3518.88320791721, 3525.35090649128,
      3531.82015669346, 3538.29095613956, 3544.76330244541,
      3551.23719322681, 3557.71262609959, 3564.18959867954,
      3570.66810810566, 3577.14815247059, 3583.62972939014,
      3590.11283695698, 3596.59747231007, 3603.08363306522,
      3609.57131731510, 3616.06052219868, 3622.55124580860,
      3629.04348576069, 3635.53723967075, 3642.03250515461,
      3648.52928030491, 3655.02756226063, 3661.52734911442,
      3668.02863895893, 3674.53142893314, 3681.03571712971,
      3687.54150116444, 3694.04877865314, 3700.55754768848,
      3707.06780588627, 3713.57955133915, 3720.09278166294,
      // logFact 675-719
      3726.60749447346, 3733.12368738651, 3739.64135849476,
      3746.16050589085, 3752.68112719059, 3759.20322000980,
      3765.72678244114, 3772.25181210041, 3778.77830708027,
      3785.30626499653, 3791.83568394184, 3798.36656153202,
      3804.89889585972, 3811.43268454075, 3817.96792566776,
      3824.50461733341, 3831.04275715351, 3837.58234322071,
      3844.12337315083, 3850.66584503651, 3857.20975697041,
      3863.75510656834, 3870.30189192295, 3876.85011112690,
      3883.39976179600, 3889.95084202290, 3896.50334990025,
      3903.05728352070, 3909.61264050007, 3916.16941893101,
      3922.72761690617, 3929.28723204136, 3935.84826290607,
      3942.41070711613, 3948.97456276417, 3955.53982794285,
      3962.10650026798, 3968.67457830906, 3975.24405968189,
      3981.81494247913, 3988.38722479343, 3994.96090519428,
      4001.53598082066, 4008.11245024204, 4014.69031155109,
      // logFact 720-764
      4021.26956284046, 4027.85020220280, 4034.43222725391,
      4041.01563656330, 4047.60042774677, 4054.18659937382,
      4060.77414953709, 4067.36307585239, 4073.95337688923,
      4080.54505074024, 4087.13809549809, 4093.73250877857,
      4100.32828915119, 4106.92543470860, 4113.52394354343,
      4120.12381422520, 4126.72504436970, 4133.32763206959,
      4139.93157589436, 4146.53687393665, 4153.14352428913,
      4159.75152504444, 4166.36087429523, 4172.97157013416,
      4179.58361113071, 4186.19699537754, 4192.81172096729,
      4199.42778599262, 4206.04518902302, 4212.66392815113,
      4219.28400146961, 4225.90540707111, 4232.52814352512,
      4239.15220892429, 4245.77760136127, 4252.40431892872,
      4259.03236019611, 4265.66172325611, 4272.29240667820,
      4278.92440855503, 4285.55772697926, 4292.19236052036,
      4298.82830727100, 4305.46556532383, 4312.10413324833,
      // logFact 765-809
      4318.74400913715, 4325.38519108295, 4332.02767765522,
      4338.67146742344, 4345.31655848026, 4351.96294891834,
      4358.61063730717, 4365.25962173939, 4371.90990078449,
      4378.56147253513, 4385.21433556080, 4391.86848795414,
      4398.52392828465, 4405.18065464497, 4411.83866560459,
      4418.49795973301, 4425.15853464603, 4431.82038938999,
      4438.48352205753, 4445.14793121815, 4451.81361496449,
      4458.48057186604, 4465.14880001545, 4471.81829798222,
      4478.48906433582, 4485.16109716892, 4491.83439505100,
      4498.50895655155, 4505.18477976322, 4511.86186325550,
      4518.54020559788, 4525.21980488300, 4531.90065968037,
      4538.58276808262, 4545.26612913609, 4551.95074093342,
      4558.63660204411, 4565.32371056080, 4572.01206505299,
      4578.70166409016, 4585.39250624180, 4592.08459007740,
      4598.77791368961, 4605.47247564793, 4612.16827452183,
      // logFact 810-854
      4618.86530888081, 4625.56357681751, 4632.26307737827,
      4638.96380865574, 4645.66576921940, 4652.36895716190,
      4659.07337152958, 4665.77901041508, 4672.48587286472,
      4679.19395697117, 4685.90326130390, 4692.61378443241,
      4699.32552492619, 4706.03848135471, 4712.75265181065,
      4719.46803534031, 4726.18463003635, 4732.90243494511,
      4739.62144815922, 4746.34166824818, 4753.06309378147,
      4759.78572380543, 4766.50955641270, 4773.23459017277,
      4779.96082365513, 4786.68825542927, 4793.41688406467,
      4800.14670813084, 4806.87772619724, 4813.60993683338,
      4820.34333860874, 4827.07793009281, 4833.81371033192,
      4840.55067741871, 4847.28882992268, 4854.02816641331,
      4860.76868593693, 4867.51038658619, 4874.25326740742,
      4880.99732649326, 4887.74256289005, 4894.48897516727,
      4901.23656189442, 4907.98532164097, 4914.73525297642,
      // logFact 855-899
      4921.48635447025, 4928.23862469196, 4934.99206268787,
      4941.74666655064, 4948.50243532658, 4955.25936758518,
      4962.01746189594, 4968.77671730518, 4975.53713190556,
      4982.29870474339, 4989.06143438816, 4995.82531940937,
      5002.59035837650, 5009.35654985905, 5016.12389290333,
      5022.89238607883, 5029.66202795506, 5036.43281757832,
      5043.20475304127, 5049.97783339024, 5056.75205719471,
      5063.52742350101, 5070.30393040180, 5077.08157694340,
      5083.86036169529, 5090.64028370380, 5097.42134153843,
      5104.20353376865, 5110.98685896397, 5117.77131617069,
      5124.55690395832, 5131.34362089634, 5138.13146603107,
      5144.92043793201, 5151.71053516865, 5158.50175678730,
      5165.29410135746, 5172.08756744862, 5178.88215410709,
      5185.67785990238, 5192.47468340397, 5199.27262365818,
      5206.07167971134, 5212.87184965611, 5219.67313253880,
      // logFact 900-944
      5226.47552740574, 5233.27903282642, 5240.08364737034,
      5246.88937008381, 5253.69619953632, 5260.50413429737,
      5267.31317341328, 5274.12331593037, 5280.93456041813,
      5287.74690544605, 5294.56035006046, 5301.37489283085,
      5308.19053280354, 5315.00726854801, 5321.82509911060,
      5328.64402306080, 5335.46403944492, 5342.28514683247,
      5349.10734426975, 5355.93063032627, 5362.75500404835,
      5369.58046400547, 5376.40700924397, 5383.23463833332,
      5390.06335031986, 5396.89314424992, 5403.72401869297,
      5410.55597221851, 5417.38900387287, 5424.22311270237,
      5431.05829727650, 5437.89455664158, 5444.73188936710,
      5451.57029449940, 5458.40977108479, 5465.25031769276,
      5472.09193336964, 5478.93461668491, 5485.77836668491,
      5492.62318193913, 5499.46906197071, 5506.31600487232,
      5513.16401016712, 5520.01307642460, 5526.86320269108,
      // logFact 945-989
      5533.71438753605, 5540.56663000584, 5547.41992914677,
      5554.27428352833, 5561.12969219685, 5567.98615419865,
      5574.84366810322, 5581.70223295689, 5588.56184780598,
      5595.42251169682, 5602.28422319889, 5609.14698088169,
      5616.01078426838, 5622.87563192844, 5629.74152290821,
      5636.60845625401, 5643.47643053532, 5650.34544479847,
      5657.21549808979, 5664.08658945560, 5670.95871746540,
      5677.83188116550, 5684.70607960224, 5691.58131182194,
      5698.45757639408, 5705.33487236500, 5712.21319878101,
      5719.09255468845, 5725.97293865681, 5732.85434973240,
      5739.73678743839, 5746.62024986744, 5753.50473654270,
      5760.39024603367, 5767.27677786350, 5774.16433060169,
      5781.05290329456, 5787.94249451160, 5794.83310377598,
      5801.72472965717, 5808.61737120152, 5815.51102745533,
      5822.40569746494, 5829.30138027668, 5836.19807446003,
      // logFact 990-1000
      5843.09577953815, 5849.99449408054, 5856.89421713352,
      5863.79494774342, 5870.69668495655, 5877.59942781925,
      5884.50317490101, 5891.40792572498, 5898.31367886066,
      5905.22043383121, 5912.12818920612 
   };

   Real LnBang::operator() (long n)
   {
      Real result=.0;
      if (n >= 0 && n < (long)s_NFACT)
      {
         result = s_logFact[n];
      }
      else
      {
         Real xiter = n + 1.0;
         Real dsum = 1.000000000190015;
         for (int i=0; i<s_NCOEFF; ++i)
         {
            xiter += 1.0;
            dsum += s_coeff[i]/xiter;
         }
         result = (n + 1.5)*std::log(n + 6.5) - (n + 6.5) 
                        + std::log(s_step*dsum/(n + 1.0));
      }
      return result;
   }
}
